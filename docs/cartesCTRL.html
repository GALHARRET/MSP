<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MSP – cartesctrl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MSP</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./capabilite.html" rel="" target="">
 <span class="menu-text">Capabilité</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./cartesCTRL.html" rel="" target="" aria-current="page">
 <span class="menu-text">Cartes de contrôle</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./bibliographie.html" rel="" target="">
 <span class="menu-text">Bibliographie</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#cartes-de-contrôle" id="toc-cartes-de-contrôle" class="nav-link active" data-scroll-target="#cartes-de-contrôle">Cartes de contrôle</a>
  <ul class="collapse">
  <li><a href="#historique" id="toc-historique" class="nav-link" data-scroll-target="#historique">Historique</a></li>
  <li><a href="#comprendre-les-variations-des-procédés-de-fabrication" id="toc-comprendre-les-variations-des-procédés-de-fabrication" class="nav-link" data-scroll-target="#comprendre-les-variations-des-procédés-de-fabrication">Comprendre les variations des procédés de fabrication</a></li>
  <li><a href="#cartes-de-contrôles-de-shewhart" id="toc-cartes-de-contrôles-de-shewhart" class="nav-link" data-scroll-target="#cartes-de-contrôles-de-shewhart">Cartes de contrôles de Shewhart</a>
  <ul class="collapse">
  <li><a href="#principe" id="toc-principe" class="nav-link" data-scroll-target="#principe">Principe</a></li>
  <li><a href="#distribution-des-paramètres" id="toc-distribution-des-paramètres" class="nav-link" data-scroll-target="#distribution-des-paramètres">Distribution des paramètres</a></li>
  <li><a href="#estimation-des-limites-de-contrôle-pour-la-carte-de-la-moyenne." id="toc-estimation-des-limites-de-contrôle-pour-la-carte-de-la-moyenne." class="nav-link" data-scroll-target="#estimation-des-limites-de-contrôle-pour-la-carte-de-la-moyenne.">Estimation des limites de contrôle pour la carte de la moyenne.</a></li>
  <li><a href="#estimation-des-limites-de-contrôle-pour-la-carte-des-étendues" id="toc-estimation-des-limites-de-contrôle-pour-la-carte-des-étendues" class="nav-link" data-scroll-target="#estimation-des-limites-de-contrôle-pour-la-carte-des-étendues">Estimation des limites de contrôle pour la carte des étendues</a></li>
  </ul></li>
  <li><a href="#efficacité-des-cartes-de-shewhart" id="toc-efficacité-des-cartes-de-shewhart" class="nav-link" data-scroll-target="#efficacité-des-cartes-de-shewhart">Efficacité des cartes de Shewhart</a>
  <ul class="collapse">
  <li><a href="#déréglage-de-la-moyenne" id="toc-déréglage-de-la-moyenne" class="nav-link" data-scroll-target="#déréglage-de-la-moyenne">Déréglage de la moyenne</a></li>
  <li><a href="#déréglage-de-lécart-type" id="toc-déréglage-de-lécart-type" class="nav-link" data-scroll-target="#déréglage-de-lécart-type">Déréglage de l’écart type</a></li>
  </ul></li>
  <li><a href="#période-opérationelle-moyenne-average-run-length" id="toc-période-opérationelle-moyenne-average-run-length" class="nav-link" data-scroll-target="#période-opérationelle-moyenne-average-run-length">Période opérationelle moyenne (Average Run Length)</a>
  <ul class="collapse">
  <li><a href="#calibration-des-tailles-de-prélèvement" id="toc-calibration-des-tailles-de-prélèvement" class="nav-link" data-scroll-target="#calibration-des-tailles-de-prélèvement">Calibration des tailles de prélèvement</a></li>
  <li><a href="#cartes-tenant-compte-des-tolérances" id="toc-cartes-tenant-compte-des-tolérances" class="nav-link" data-scroll-target="#cartes-tenant-compte-des-tolérances">Cartes tenant compte des tolérances</a></li>
  <li><a href="#carte-de-la-moyenne-aux-limites-modifiées" id="toc-carte-de-la-moyenne-aux-limites-modifiées" class="nav-link" data-scroll-target="#carte-de-la-moyenne-aux-limites-modifiées">Carte de la moyenne aux limites modifiées</a></li>
  <li><a href="#calibration-de-la-taille-des-échantillons" id="toc-calibration-de-la-taille-des-échantillons" class="nav-link" data-scroll-target="#calibration-de-la-taille-des-échantillons">Calibration de la taille des échantillons :</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  <li><a href="#cartes-ewma" id="toc-cartes-ewma" class="nav-link" data-scroll-target="#cartes-ewma">Cartes EWMA</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="cartes-de-contrôle" class="level1">
<h1>Cartes de contrôle</h1>
<section id="historique" class="level2">
<h2 class="anchored" data-anchor-id="historique">Historique</h2>
<ul>
<li><p>Inventées par Walter A. Shewhart (années 1920)</p></li>
<li><p>S’utilisent dans de très nombreux secteurs d’activité (industrie, transport, service, …)</p></li>
<li><p>Suivi et/ou amélioration d’un système de production</p></li>
</ul>
<p><strong>Avantages</strong></p>
<ul>
<li><p>Très faciles à mettre en oeuvre</p></li>
<li><p>Très faciles à interpréter (graphiques)</p></li>
</ul>
<p><strong>Inconvénients</strong></p>
<ul>
<li><p>Ne tient pas a priori compte des tolérances</p></li>
<li><p>N’est pas toujours efficace (ex : si problème de déviation progressive)</p></li>
</ul>
</section>
<section id="comprendre-les-variations-des-procédés-de-fabrication" class="level2">
<h2 class="anchored" data-anchor-id="comprendre-les-variations-des-procédés-de-fabrication">Comprendre les variations des procédés de fabrication</h2>
<p>On distingue plusieurs causes qui peuvent induire des variations dans un système de production :</p>
<ul>
<li><p><strong><em>causes aléatoires</em></strong> (communes) elles sont en grand nombre avec un effet individuel faible. On peut les modéliser par une variable aléatoire (en général gaussienne). Elles peuvent être corrigées par des actions sur le système global. Exemple : temps de trajet domicile-travail. Si il y a des feux rouges sur le trajet ceux-ci pourront être parfois verts ou rouges, il peut y avoir plus ou moins de circulation… Action globale : changer de route pour ne plus avoir de feux rouges !</p></li>
<li><p><strong><em>causes assignables</em></strong> (spéciales) elles sont rares et ne peuvent pas être associées directement au procédé de fabrication (Deming 1986). Elles peuvent être corrigées par des actions locales. Exemple : un accident de la route se produit sur le trajet.</p></li>
</ul>
<p>Un processus est dit <strong><em>sous contrôle ou statistiquement stable</em></strong> lorsque les variations sont uniquement dûes à des causes aléatoires.</p>
</section>
<section id="cartes-de-contrôles-de-shewhart" class="level2">
<h2 class="anchored" data-anchor-id="cartes-de-contrôles-de-shewhart">Cartes de contrôles de Shewhart</h2>
<section id="principe" class="level3">
<h3 class="anchored" data-anchor-id="principe">Principe</h3>
<p>On va construire deux graphiques : une carte dite de position et une carte de dispersion.</p>
<p><strong><em>Exemple</em></strong></p>
<p>Suivi de production journalière de steacks hachés surgelés durant 12h de production. Chaque heure on prélève 5 steaks et on les pèse.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"exemple_carte_Shewhart.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">X</th>
<th style="text-align: right;">weight.1</th>
<th style="text-align: right;">weight.2</th>
<th style="text-align: right;">weight.3</th>
<th style="text-align: right;">weight.4</th>
<th style="text-align: right;">weight.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">98.6</td>
<td style="text-align: right;">100.3</td>
<td style="text-align: right;">100.9</td>
<td style="text-align: right;">100.2</td>
<td style="text-align: right;">99.6</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">100.3</td>
<td style="text-align: right;">99.5</td>
<td style="text-align: right;">98.9</td>
<td style="text-align: right;">100.2</td>
<td style="text-align: right;">100.6</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">99.2</td>
<td style="text-align: right;">98.8</td>
<td style="text-align: right;">101.5</td>
<td style="text-align: right;">100.3</td>
<td style="text-align: right;">101.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">101.1</td>
<td style="text-align: right;">97.8</td>
<td style="text-align: right;">98.9</td>
<td style="text-align: right;">101.3</td>
<td style="text-align: right;">101.7</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">101.0</td>
<td style="text-align: right;">99.8</td>
<td style="text-align: right;">97.3</td>
<td style="text-align: right;">99.4</td>
<td style="text-align: right;">100.8</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">101.1</td>
<td style="text-align: right;">100.1</td>
<td style="text-align: right;">99.0</td>
<td style="text-align: right;">100.7</td>
<td style="text-align: right;">99.9</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span>data[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Carte de la moyenne avec la librairie qcc dans R</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>X<span class="ot">&lt;-</span><span class="fu">qcc</span>(df,<span class="at">type=</span><span class="st">"xbar"</span>,<span class="at">title=</span><span class="st">"Carte de la moyenne"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="cartesCTRL_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Carte de l'étendue avec la librairie qcc dans R</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>X<span class="ot">&lt;-</span><span class="fu">qcc</span>(df,<span class="at">type=</span><span class="st">"R"</span>,<span class="at">title=</span><span class="st">"Carte de l'étendue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="cartesCTRL_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Pour chaque échantillon de 5 steacks on calcule la moyenne et l’étendue et on les reporte sur les cartes correspondantes.</p>
</section>
<section id="distribution-des-paramètres" class="level3">
<h3 class="anchored" data-anchor-id="distribution-des-paramètres">Distribution des paramètres</h3>
<p>On suppose que tous les paramètres suivent une loi normale.</p>
<ul>
<li><p>La moyenne d’un échantillon <span class="math inline">\(\bar X \sim \mathcal N(\mu,\frac{\sigma}{\sqrt n}).\)</span></p></li>
<li><p>L’étendue d’un échantillon <span class="math inline">\(R \sim \mathcal N(\mu_R,\sigma_R).\)</span></p></li>
<li><p>L’écart type d’un échantillon <span class="math inline">\(S \sim \mathcal N(\mu_S,\sigma_S).\)</span></p></li>
</ul>
<p>On définit alors les limites de surveillance et de contrôle pour chaque carte. Pour la carte de la moyenne :</p>
<p><img src="figures/carte_ctrl1.png" class="img-fluid"> On se fixe un risque <span class="math inline">\(\alpha\)</span> de stoper la production alors que celle-ci est sous contrôle (<strong><em>Fausses alertes</em></strong>). On cherche donc un intervalle de confiance <span class="math inline">\(1-\alpha\)</span> de <span class="math inline">\(\bar X\)</span> La distribution des moyennes étant normale on a</p>
<p><span class="math display">\[
\begin{cases}
LI=\mu-z_{1-\alpha/2}\frac{\sigma}{\sqrt n} \\
LS=\mu+z_{1-\alpha/2}\frac{\sigma}{\sqrt n} \\
\mathbb P(LI&lt;\bar X&lt;LS)=1-\alpha
\end{cases}
\]</span></p>
<p>On pourra en conclure que la moyenne <span class="math inline">\(\bar X\)</span> de l’échantillon considéré n’est pas significativement différente de la moyenne <span class="math inline">\(\mu\)</span> (c’est à dire que le procédé est sous contrôle) si <span class="math inline">\(\bar X&nbsp;\in [LI,LS].\)</span></p>
<p>Les <strong><em>limites de surveillance</em></strong> sont définies de façon à déterminer, au risque de 4.5%, les moyennes significativement différentes de la moyenne globale :</p>
<ul>
<li><p>Limite inférieure de surveillance : <span class="math inline">\(LIS=\mu-2\frac{\sigma}{\sqrt n}\)</span></p></li>
<li><p>Limite supérieure de surveillance : <span class="math inline">\(LSS=\mu+2\frac{\sigma}{\sqrt n}\)</span></p></li>
</ul>
<p>Les <strong><em>limites de contrôle</em></strong> sont définies de façon à déterminer, au risque de 0.3% de fausses alertes, les moyennes significativement différentes de la moyenne globale :</p>
<ul>
<li><p>Limite inférieure de contrôle : <span class="math inline">\(LIS=\mu-3\frac{\sigma}{\sqrt n}\)</span></p></li>
<li><p>Limite supérieure de contrôle : <span class="math inline">\(LSS=\mu+3\frac{\sigma}{\sqrt n}\)</span></p></li>
</ul>
</section>
<section id="estimation-des-limites-de-contrôle-pour-la-carte-de-la-moyenne." class="level3">
<h3 class="anchored" data-anchor-id="estimation-des-limites-de-contrôle-pour-la-carte-de-la-moyenne.">Estimation des limites de contrôle pour la carte de la moyenne.</h3>
<p>Reprenons le cas précédent. Pour chaque échantillon on peut calculer <span class="math inline">\(\bar y_j,R_j\)</span> la moyenne et l’étendue.</p>
<p>On a vu dans le chapitre précédent que <span class="math inline">\(\hat\mu=\overline{\overline{y}}=\frac 1{k} \displaystyle\sum_{j=1}^k \bar y_{j}\)</span> et que <span class="math inline">\(\hat \sigma = \dfrac{\bar R}{d_2}\)</span>. Donc on a : <span class="math display">\[
\begin{cases}
\widehat{LIC}= \bar{\bar{y}}-\frac{3}{\sqrt n} \frac{\overline R}{d_2} \\
\widehat{LSC}= \bar{\bar{y}}+\frac{3}{\sqrt n} \frac{\overline R}{d_2}
\end{cases}
\]</span></p>
</section>
<section id="estimation-des-limites-de-contrôle-pour-la-carte-des-étendues" class="level3">
<h3 class="anchored" data-anchor-id="estimation-des-limites-de-contrôle-pour-la-carte-des-étendues">Estimation des limites de contrôle pour la carte des étendues</h3>
<p>Pour l’estimation de <span class="math inline">\(\mu_R\)</span> on prend <span class="math inline">\(\hat\mu_R=\bar R\)</span>, et pour l’estimation de <span class="math inline">\(\sigma_R\)</span> on prend <span class="math inline">\(\hat \sigma_R=\frac{d_3}{d_2}\bar R\)</span> où <span class="math inline">\(d_3\)</span> est l’écart type des étendues d’une loi normale centrée réduite. On a alors <span class="math display">\[
\begin{cases}
\widehat{LIC}= \overline{R}-3\frac{d_3}{d_2}\overline R \\
\widehat{LSC}= \overline{R}+3\frac{d_3}{d_2}\overline R
\end{cases}
\]</span></p>
</section>
</section>
<section id="efficacité-des-cartes-de-shewhart" class="level2">
<h2 class="anchored" data-anchor-id="efficacité-des-cartes-de-shewhart">Efficacité des cartes de Shewhart</h2>
<p>La notion d’efficacité d’une carte de contrôle est sa capacité à détecter un dérèglement alors que la production semble rester sous contrôle.</p>
<p>Le dérèglement peut concerner un décentrage (dérèglement de la moyenne) ou bien une augmentation de la dispersion.</p>
<section id="déréglage-de-la-moyenne" class="level3">
<h3 class="anchored" data-anchor-id="déréglage-de-la-moyenne">Déréglage de la moyenne</h3>
<p><img src="figures/decentrage_moy.png" class="img-fluid"> Un décentrage de moyenne est exprimé en nombre d’écart type (unité standardisé) donc si <span class="math inline">\(\mu_1\)</span> est la moyenne décentrée, on lui associera le décentrage</p>
<p><span class="math display">\[
\rho=\frac{|\mu_1-\mu|}{\sigma}
\]</span></p>
<p>La probabilité <span class="math inline">\(\beta\)</span> de ne pas détecter le décentrage est alors</p>
<p><span class="math display">\[
\beta=\mathbb P(LIC&lt;\widetilde X &lt;LSC)
\]</span></p>
<p>où <span class="math inline">\(\widetilde X \sim \mathcal N(\mu+\rho\sigma,\frac{\sigma}{n}).\)</span> Un calcul simple permet d’obtenir</p>
<p><span class="math display">\[
\beta = F(3-\rho\sqrt n)-F(-3-\rho\sqrt n)
\]</span></p>
<p>où <span class="math inline">\(F(x)=\mathbb P(X&lt;x)\)</span> est la fonction de répartition de la loi normale.</p>
<p><strong><em>L’efficacité de la carte est mesurée par <span class="math inline">\(1-\beta\)</span> (appelée puissance de la carte). </em></strong></p>
<p>On obtient ainsi les courbes d’efficacité de la carte de la moyenne en fonction de la taille <span class="math inline">\(n\)</span> des échantillons prélevés.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="cartesCTRL_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li><p>On constate (ce qui est logique) que la probabilité de ne pas détecter un déréglage donné diminue en fonction de la taille de l’échantillon.</p></li>
<li><p>Détecter un déréglage <span class="math inline">\(\rho=0\)</span> correspond à une fausse alerte qui vaut pour la carte de la moyenne <span class="math inline">\(\alpha=0.3\%\)</span>.</p></li>
</ul>
</section>
<section id="déréglage-de-lécart-type" class="level3">
<h3 class="anchored" data-anchor-id="déréglage-de-lécart-type">Déréglage de l’écart type</h3>
<p>Ici on considère des décentrages <span class="math inline">\(\rho&gt;1\)</span> (sinon il s’agit d’une amélioration de la dispersion).</p>
<p>Un calcul similaire au précédent conduit à <span class="math display">\[
\beta=F(\frac{3}{\rho})-F(\frac{-3}{\rho})
\]</span> Ici on constate que l’efficacité de la carte est indépendante de <span class="math inline">\(n\)</span> et qu’elle est très mauvaise. Il faut une très grande valeur de <span class="math inline">\(\rho\)</span> pour avoir une petite valeur de <span class="math inline">\(\beta\)</span>.</p>
<p>Par exemple pour <span class="math inline">\(\rho=3\)</span> on a <span class="math inline">\(\beta=\)</span> 0.6826895 c’est à dire pour un écart type qui triplerait la probabilité ne peut pas détecter ce dérèglement est de 68.3%.</p>
</section>
</section>
<section id="période-opérationelle-moyenne-average-run-length" class="level2">
<h2 class="anchored" data-anchor-id="période-opérationelle-moyenne-average-run-length">Période opérationelle moyenne (Average Run Length)</h2>
<p>La Période Opérationnelle Moyenne correspond au nombre de prélèvements qu’il faut effectuer, en moyenne, pour sortir des limites de contrôle lorsque qu’un déréglage <span class="math inline">\(\rho\)</span> s’est produit.</p>
<p>Le cas <span class="math inline">\(\rho=0\)</span> pour une carte de Shewhart avec des observations indépendantes correspond à une fausse alerte qui se produit dans <span class="math inline">\(\alpha=0.3\%\)</span> et correspond à</p>
<p><span class="math display">\[
ARL_0=\frac{1}{0.003}=333
\]</span> donc il faut en moyenne 334 prélèvements avant de détecter une fausse alerte.</p>
<p><span class="math inline">\(ARL\)</span> est définie par</p>
<p><span class="math display">\[
ARL_\rho=\frac 1{1-\beta}
\]</span></p>
<p><strong><em>C’est donc l’inverse de la puissance (efficacité) de la carte, donc plus ce nombre sera petit plus la carte sera efficace.</em></strong></p>
<p>Si on reprend les courbes d’efficacité précédente on obtient :</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="cartesCTRL_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="calibration-des-tailles-de-prélèvement" class="level3">
<h3 class="anchored" data-anchor-id="calibration-des-tailles-de-prélèvement">Calibration des tailles de prélèvement</h3>
<p>La production initiale est <span class="math inline">\(X\sim \mathcal N (\mu,\sigma)\)</span> et la production décentrée vaut <span class="math inline">\(\widetilde X \sim \mathcal N (\mu+\rho\sigma,\sigma)\)</span>. On sait calculer la probabilité <span class="math inline">\(1-\beta\)</span> de détecter le décentrage en fonction de <span class="math inline">\(\rho\)</span> et on a donc</p>
<p><span class="math display">\[
ARL_\rho=\frac 1{1-\beta}=\frac 1{1-F(3-\rho\sqrt n)+F(-3-\rho\sqrt n)}
\]</span></p>
<p>Exemple :</p>
<p>Considérons le problème suivant : on a un décentrage de moyenne de 0.5 écart type. On voudrait le détecter en moyenne avant 50 prélèvements. Quelle taille d’échantillon doit-on considérer ?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>n<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">20</span>,<span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>rho<span class="ot">&lt;-</span>.<span class="dv">5</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>beta<span class="ot">=</span><span class="fu">pnorm</span>(<span class="dv">3</span><span class="sc">-</span>rho<span class="sc">*</span><span class="fu">sqrt</span>(n))<span class="sc">-</span><span class="fu">pnorm</span>(<span class="sc">-</span><span class="dv">3</span><span class="sc">-</span>rho<span class="sc">*</span><span class="fu">sqrt</span>(n))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>ARL<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>beta)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>J<span class="ot">&lt;-</span><span class="fu">which.max</span>(ARL<span class="sc">&lt;</span><span class="dv">50</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>n[J]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
</div>
</section>
<section id="cartes-tenant-compte-des-tolérances" class="level3">
<h3 class="anchored" data-anchor-id="cartes-tenant-compte-des-tolérances">Cartes tenant compte des tolérances</h3>
<p>Pour l’instant les cartes qui ont été proposées ne tiennent pas compte des tolérances imposées par le client. Elles reposent uniquement sur la distribution des observations et sur le % de fausses alertes que l’on souhaite observer (0.3% dans les cartes précédentes).</p>
<ul>
<li><p>On suppose connaître les tolérances <span class="math inline">\(TI,TS\)</span> autorisées par le client.</p></li>
<li><p>On suppose que la production suit une loi normale <span class="math inline">\(\mathcal N(\mu,\sigma).\)</span></p></li>
<li><p>On définit les moyennes maximales refusables (inférieures et supérieures)</p></li>
</ul>
<p><span class="math display">\[
\begin{cases}
\mu_I=TI+3\sigma \\
\mu_S=TS-3\sigma
\end{cases}
\]</span></p>
<p>Ce choix peut être relié au coefficient de performance défini dans le chapitre précédent <span class="math inline">\(Cpk=\frac{\min\left(\mu-TI;TS-\mu\right)}{3\sigma}\)</span>. Si on remplace <span class="math inline">\(\mu\)</span> par <span class="math inline">\(\mu_I\)</span> on obtient</p>
<p><span class="math inline">\(\frac{\min\left(\mu_I-TI;TS-\mu_I\right)}{3\sigma}=\min(1;\frac{TS-TI-3\sigma}{3\sigma}).\)</span> On peut faire un calcul similaire avec <span class="math inline">\(\mu_S.\)</span></p>
<ul>
<li><p>Ce nombre vaut 1 si <span class="math inline">\(\frac{TS-TI-3\sigma}{3\sigma}&gt;1\)</span> ce qui revient à <span class="math inline">\(Cap&gt;1.\)</span> C’est à dire que lorsque le procédé est sous contrôle on va autoriser une déviation de la moyenne.</p></li>
<li><p>Ce nombre vaut <span class="math inline">\(\frac{TS-TI-3\sigma}{3\sigma}\)</span> sinon et dans ce cas <span class="math inline">\(Cap&lt;1,\)</span> le procédé ne répond pas aux spécifications imposées par le client. Il faut dans ce cas agir sur le procédé.</p></li>
</ul>
</section>
<section id="carte-de-la-moyenne-aux-limites-modifiées" class="level3">
<h3 class="anchored" data-anchor-id="carte-de-la-moyenne-aux-limites-modifiées">Carte de la moyenne aux limites modifiées</h3>
<p>Par exemple si on a une prodcution <span class="math inline">\(X \sim \mathcal N(3,0.5)\)</span> avec des tolérances <span class="math inline">\(TI=1\)</span> et <span class="math inline">\(TS=5\)</span>, on a <span class="math inline">\(TS-TI &gt;&gt; 6\sigma\)</span> donc on peut faire une carte de la moyenne aux limites modifiées les nouvelles limites <span class="math inline">\(LIC^*,LSC^*\)</span> étant égales à <span class="math inline">\(\mu_I,\mu_S.\)</span></p>
<p><img src="figures/carte_lim_mod.png" class="img-fluid"></p>
</section>
<section id="calibration-de-la-taille-des-échantillons" class="level3">
<h3 class="anchored" data-anchor-id="calibration-de-la-taille-des-échantillons">Calibration de la taille des échantillons :</h3>
<p>On peut également définir le <strong><em>déraglage maximal admissible</em></strong> <span class="math inline">\(\rho_{max}\)</span> par</p>
<p><span class="math display">\[
\rho_{max}=\min\left( \frac{\mu_S-\mu}{\sigma},\frac{\mu-\mu_I}{\sigma}\right)
\]</span></p>
<p>On va alors calibrer la taille <span class="math inline">\(n\)</span> des échantillons à prélever de façon à détecter le déréglage maximal admissible à un risque <span class="math inline">\(\beta\)</span> fixé de ne pas détecter ce déréglage maximal <span class="math inline">\(\rho_max\)</span>. D’après ce qui précède <span class="math inline">\(n\)</span> sera le plus petit entier tel que</p>
<p><span class="math display">\[
n \geq \left( \frac{3+z_{1-\beta}}{\rho_{max}} \right)^2
\]</span></p>
<p>où <span class="math inline">\(z_{1-\beta}\)</span> est le quantile d’ordre <span class="math inline">\((1-\beta)\)</span> de la loi normale.</p>
<section id="retour-à-lexemple" class="level4">
<h4 class="anchored" data-anchor-id="retour-à-lexemple">Retour à l’exemple</h4>
<p>Avec les valeurs précédentes on a <span class="math inline">\(\rho_{max}=3.\)</span> Si on veut détecter ce déréglage dans 95% des cas alors on doit avoir <span class="math inline">\(n \geq 2.7\)</span></p>
<p>Prélever des échantillons de taille <span class="math inline">\(n=3\)</span> suffit à détecter dans 95% des cas des décentrages d’au moins 3 écarts types.</p>
</section>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<p>La carte de Shewhart de la moyenne est très simple à mettre en oeuvre et à interpréter. Cependant elle n’a pas une très grande efficacité surtout :</p>
<ul>
<li><p>en cas de faibles et moyennes déviations</p></li>
<li><p>en cas de structure d’autocorrélation, c’est à dire lorsque le passé a une influence, par exemple lorsqu’une tendance croissante apparaît.</p></li>
</ul>
<p>Exemple d’application</p>
<p>On suit une production de caractéristique <span class="math inline">\(\mu=15\)</span> et <span class="math inline">\(\sigma=2\)</span>. Pour ce faire 14 prélèvements de 4 unités de production ont été réalisés. On construit la carte de moyenne de Shewhart. A partir du 4ième prélèvement on constate une déviation de la moyenne et un décentrage supérieur. La carte de Shewhart ne détecte cette déviation que très tardivement (14ième prélèvement).</p>
<div class="cell" data-warnings="false">
<div class="cell-output-display">
<p><img src="cartesCTRL_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Une des solutions est la carte EWMA</p>
</section>
</section>
<section id="cartes-ewma" class="level2">
<h2 class="anchored" data-anchor-id="cartes-ewma">Cartes EWMA</h2>
<p>EWMA : Exponentially Weighted Moving Average</p>
<p>On définit la statistique <span class="math inline">\(z_i\)</span> par une relation de récurrence pour tout <span class="math inline">\(i=1,...,k\)</span></p>
<p><span class="math display">\[
z_i=\lambda \bar x_i +(1-\lambda)z_{i-1},
\]</span></p>
<p>où <span class="math inline">\(\bar x_i\)</span> est la moyenne des unités pour le prélèvement <span class="math inline">\(i\)</span> et <span class="math inline">\(0&lt;\lambda\leq 1\)</span> est un réel qui sera choisi en fonction du poids que l’on veut donner aux données précédentes. En effet, en général on choisit <span class="math inline">\(z_0=\mu\)</span> (moyenne du procédé de fabrication). On a <span class="math display">\[
\begin{cases}
z_1=\lambda \bar x_1+(1-\lambda)\mu \\
z_2=\lambda \bar x_2+(1-\lambda)z_1= \lambda \bar x_2+\lambda(1-\lambda)\bar x_1+(1-\lambda)^2\mu \\
z_3=\lambda \bar x_3+\lambda(1-\lambda)\bar x_2+\lambda(1-\lambda)^2\bar x_1+
(1-\lambda)^3\mu \\
\ldots
\end{cases}
\]</span></p>
<div class="cell">
<div class="cell-output-display">
<p><img src="cartesCTRL_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li><p>La cas <span class="math inline">\(\lambda=1\)</span> correspond à la carte de Shewhart sur la moyenne.</p></li>
<li><p>On constate que <span class="math inline">\(\bar x_i\)</span> a une importance d’autant plus importante dans <span class="math inline">\(z_i\)</span> que <span class="math inline">\(\lambda\)</span> est grand.</p></li>
<li><p>En général on utilise <span class="math inline">\(0.25&lt;\lambda&lt;0.5\)</span>.</p></li>
<li><p>Les limites de ces cartes sont variables (en fonction de <span class="math inline">\(i\)</span>) et on a pour une production <span class="math inline">\(X\sim \mathcal N(\mu,\sigma)\)</span></p></li>
</ul>
<p><span class="math display">\[
LC = \mu  \pm L\frac{\sigma}{\sqrt{n}}\times \sqrt {\frac{\lambda}{2-\lambda}[1-(1-\lambda)^{2i}] }
\]</span></p>
<ul>
<li><p>Lorsque le nombre <span class="math inline">\(i\)</span> de prélèvement est très grand alors <span class="math inline">\(LC = \mu \pm L\frac{\sigma}{\sqrt{n}}\times \sqrt {\frac{\lambda}{2-\lambda}}\)</span>. Dans ce cas on peut jouer sur ce paramètre <span class="math inline">\(L\)</span> pour améliorer l’efficacité de la carte en fonction de <span class="math inline">\(\lambda\)</span>.</p></li>
<li><p>On constate que sur les petites déviations de production l’efficacité des cartes EWMA est bien supérieure à celle de la carte de Shewhart.</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<p><img src="cartesCTRL_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On peut réaliser la carte sur R concernant l’exemple du chapitre précédent. On constate que contrairement à la carte de la moyenne la carte EWMA détecte le décentrage dès le 8ième prélèvement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Y<span class="ot">&lt;-</span><span class="fu">ewma</span>(data,<span class="at">center =</span> <span class="dv">15</span>,<span class="at">std.dev =</span> <span class="dv">2</span>,<span class="at">sizes =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="cartesCTRL_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>